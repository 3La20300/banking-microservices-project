<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="1920" height="1080" viewBox="0 0 1920 1080" style="background-color:#f7f9fc">
  <defs>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap');
      text { font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif; }
      .title { font-size: 32px; font-weight: 600; fill: #1a365d; }
      .subtitle { font-size: 18px; fill: #2d4a6d; }
      .heading { font-size: 16px; font-weight: 600; fill: #2d4a6d; }
      .label { font-size: 14px; fill: #2d4a6d; }
      .small { font-size: 13px; fill: #4a668a; }
      .api { font-size: 12px; fill: #4a668a; }
      .box { filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1)); }
      .connector { stroke: #4a90e2; stroke-width: 2; fill: none; }
      .dashed { stroke-dasharray: 6 4; }
    </style>

    <!-- Gradients -->
    <linearGradient id="client-grad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#4299E1"/>
      <stop offset="100%" stop-color="#3182CE"/>
    </linearGradient>
    <linearGradient id="gateway-grad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#00B5D8"/>
      <stop offset="100%" stop-color="#0987A0"/>
    </linearGradient>
    <linearGradient id="service-grad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#667EEA"/>
      <stop offset="100%" stop-color="#5A67D8"/>
    </linearGradient>
    <linearGradient id="kafka-grad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#ED8936"/>
      <stop offset="100%" stop-color="#DD6B20"/>
    </linearGradient>
    <linearGradient id="db-grad" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#48BB78"/>
      <stop offset="100%" stop-color="#38A169"/>
    </linearGradient>

    <!-- Arrow Marker -->
    <marker id="arrow" viewBox="0 0 10 10" refX="9" refY="5"
            markerWidth="6" markerHeight="6" orient="auto">
      <path d="M 0 0 L 10 5 L 0 10 z" fill="#4a90e2"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="60" y="80" class="title">VBank Microservices Architecture</text>
  <text x="60" y="120" class="subtitle">WSO2 API Gateway + Microservices + Event-Driven Logging</text>

  <!-- Legend -->
  <g transform="translate(1500,60)">
    <rect width="360" height="140" rx="8" fill="white" class="box"/>
    <text x="20" y="30" class="heading">Legend</text>
    <g transform="translate(20,50)">
      <rect width="16" height="16" fill="url(#client-grad)" rx="4"/>
      <text x="24" y="12" class="label">Client Applications</text>
    </g>
    <g transform="translate(180,50)">
      <rect width="16" height="16" fill="url(#gateway-grad)" rx="4"/>
      <text x="24" y="12" class="label">API Gateway</text>
    </g>
    <g transform="translate(20,80)">
      <rect width="16" height="16" fill="url(#service-grad)" rx="4"/>
      <text x="24" y="12" class="label">Microservices</text>
    </g>
    <g transform="translate(180,80)">
      <rect width="16" height="16" fill="url(#kafka-grad)" rx="4"/>
      <text x="24" y="12" class="label">Event Bus</text>
    </g>
    <g transform="translate(20,110)">
      <rect width="16" height="16" fill="url(#db-grad)" rx="4"/>
      <text x="24" y="12" class="label">Database</text>
    </g>
  </g>

  <!-- Clients Layer -->
  <g transform="translate(60,180)">
    <text x="0" y="-20" class="heading">Client Applications</text>
    <rect width="300" height="100" rx="8" fill="url(#client-grad)" class="box"/>
    <text x="20" y="40" fill="white" class="label">VBank Portal</text>
    <text x="20" y="70" fill="white" class="small">App ID: vbank-portal</text>

    <rect x="340" width="300" height="100" rx="8" fill="url(#client-grad)" class="box"/>
    <text x="360" y="40" fill="white" class="label">VBank Mobile</text>
    <text x="360" y="70" fill="white" class="small">App ID: vbank-mobile</text>
  </g>

  <!-- API Gateway Layer -->
  <g transform="translate(60,340)">
    <text x="0" y="-20" class="heading">WSO2 API Gateway</text>
    <rect width="900" height="160" rx="8" fill="url(#gateway-grad)" class="box"/>
    <text x="20" y="35" fill="white" class="label">Security: OAuth2 + API Key</text>
    <text x="20" y="60" fill="white" class="small">Mediation: APP-NAME=[PORTAL|MOBILE]</text>

    <!-- API Endpoints -->
    <g transform="translate(20,80)">
      <rect width="200" height="60" rx="6" fill="white" fill-opacity="0.9"/>
      <text x="15" y="25" class="api">Register</text>
      <text x="15" y="45" class="small">/register → /users/register</text>
    </g>
    <g transform="translate(240,80)">
      <rect width="200" height="60" rx="6" fill="white" fill-opacity="0.9"/>
      <text x="15" y="25" class="api">Login</text>
      <text x="15" y="45" class="small">/login → /users/login</text>
    </g>
    <g transform="translate(460,80)">
      <rect width="200" height="60" rx="6" fill="white" fill-opacity="0.9"/>
      <text x="15" y="25" class="api">Dashboard</text>
      <text x="15" y="45" class="small">/dashboard/{userId}</text>
    </g>
    <g transform="translate(680,80)">
      <rect width="200" height="60" rx="6" fill="white" fill-opacity="0.9"/>
      <text x="15" y="25" class="api">Transactions</text>
      <text x="15" y="45" class="small">/initiation, /execution</text>
    </g>
  </g>

  <!-- Services Layer -->
  <g transform="translate(60,560)">
    <text x="0" y="-20" class="heading">Microservices</text>
    <!-- BFF -->
    <rect width="320" height="100" rx="8" fill="url(#service-grad)" class="box"/>
    <text x="20" y="40" fill="white" class="label">BFF Service</text>
    <text x="20" y="65" fill="white" class="small">Port: 8085 | Context: /bff</text>

    <!-- User Service -->
    <g transform="translate(360,0)">
      <rect width="250" height="100" rx="8" fill="url(#service-grad)" class="box"/>
      <text x="20" y="40" fill="white" class="label">User Service</text>
      <text x="20" y="65" fill="white" class="small">Port: 8081</text>
    </g>

    <!-- Account Service -->
    <g transform="translate(650,0)">
      <rect width="250" height="100" rx="8" fill="url(#service-grad)" class="box"/>
      <text x="20" y="40" fill="white" class="label">Account Service</text>
      <text x="20" y="65" fill="white" class="small">Port: 8082</text>
    </g>

    <!-- Transaction Service -->
    <g transform="translate(940,0)">
      <rect width="250" height="100" rx="8" fill="url(#service-grad)" class="box"/>
      <text x="20" y="40" fill="white" class="label">Transaction Service</text>
      <text x="20" y="65" fill="white" class="small">Port: 8083</text>
    </g>
  </g>

  <!-- Event Bus Layer -->
  <g transform="translate(1250,340)">
    <text x="0" y="-20" class="heading">Event-Driven Logging</text>
    <rect width="300" height="320" rx="8" fill="url(#kafka-grad)" class="box"/>
    <text x="20" y="40" fill="white" class="label">Kafka Message Bus</text>
    <text x="20" y="65" fill="white" class="small">Topic: banking-logs</text>

    <g transform="translate(20,100)">
      <rect width="260" height="80" rx="6" fill="white" fill-opacity="0.15"/>
      <text x="20" y="35" fill="white" class="label">Logging Service</text>
      <text x="20" y="60" fill="white" class="small">Kafka Consumer</text>
    </g>

    <g transform="translate(20,200)">
      <rect width="260" height="80" rx="6" fill="url(#db-grad)"/>
      <text x="20" y="45" fill="white" class="label">Log Store (PostgreSQL)</text>
    </g>
  </g>

  <!-- Database Layer -->
  <g transform="translate(60,720)">
    <text x="0" y="-20" class="heading">Databases</text>
    <rect width="250" height="80" rx="8" fill="url(#db-grad)" class="box"/>
    <text x="20" y="45" fill="white" class="label">User DB</text>

    <g transform="translate(360,0)">
      <rect width="250" height="80" rx="8" fill="url(#db-grad)" class="box"/>
      <text x="20" y="45" fill="white" class="label">Account DB</text>
    </g>

    <g transform="translate(720,0)">
      <rect width="250" height="80" rx="8" fill="url(#db-grad)" class="box"/>
      <text x="20" y="45" fill="white" class="label">Transaction DB</text>
    </g>
  </g>

  <!-- Connections -->
  <!-- Client to Gateway -->
  <path d="M210,280 L210,340" class="connector" marker-end="url(#arrow)"/>
  <path d="M510,280 L510,340" class="connector" marker-end="url(#arrow)"/>

  <!-- Gateway to Services -->
  <path d="M510,500 L220,560" class="connector" marker-end="url(#arrow)"/>
  <path d="M510,500 L485,560" class="connector" marker-end="url(#arrow)"/>

  <!-- BFF to Services -->
  <path d="M380,610 L485,610" class="connector" marker-end="url(#arrow)"/>
  <path d="M380,610 C500,610 600,610 775,610" class="connector" marker-end="url(#arrow)"/>
  <path d="M380,610 C500,610 800,610 1065,610" class="connector" marker-end="url(#arrow)"/>

  <!-- Services to DBs -->
  <path d="M485,660 L185,720" class="connector" marker-end="url(#arrow)"/>
  <path d="M775,660 L485,720" class="connector" marker-end="url(#arrow)"/>
  <path d="M1065,660 L845,720" class="connector" marker-end="url(#arrow)"/>

  <!-- Services to Kafka -->
  <path d="M1190,610 L1250,500" class="connector dashed" marker-end="url(#arrow)"/>
  <path d="M900,560 C1000,540 1100,520 1250,500" class="connector dashed" marker-end="url(#arrow)"/>
  <path d="M610,560 C800,520 1000,500 1250,500" class="connector dashed" marker-end="url(#arrow)"/>
  <path d="M220,560 C600,500 900,480 1250,500" class="connector dashed" marker-end="url(#arrow)"/>

  <!-- Footer -->
  <text x="60" y="1040" class="small" fill="#4a668a">
    Solid lines: REST API calls | Dashed lines: Event messages | All external requests are authenticated through WSO2 Gateway
  </text>
</svg>
